## 垃圾回收

### 内存泄漏
内存泄漏就是 不再使用的内存空间 没有被释放，导致程序可用内存空间越来越少

如何避免泄露
在生产环境中不要使用console.log
事件处理函数记得清空
使用WeakMap WeakSet 替代 Map Set

### 垃圾回收算法
1. 引用计数器 少用 无法解决循环引用
2. 标记清除 常用 先标记使用 后清除未使用

先从全局执行上下文开始，BFS 把所有能访问到的节点都标记为 1 最终把不能访问到的清空

### 分代回收策略
为什么要分代?
对于小的对象，复制的成本更小 对于大的对象，删除紧凑的成本更小
大部分的小对象在创建之后将会很快变成不可达

新生代 两个区域 From To
回收的时候，把标记为1的从From拷贝到To
清空From
把 From 和 To区域交换 

老生带 
把未标记的对象直接删除，会产生内存碎片，需要紧凑

### 三色标记 + 增量更新 / 历史快照
垃圾回收的过程会导致系统暂停，为了减少对程序的影响，垃圾回收会和程序并行运行
问题:
 多标 问题不大
 漏标 会造成程序错误 需要解决

三色标记:
 - 白色 不可达 最开始所有节点的状态
 - 灰色 可达 但是子节点是否都可达还不确定
 - 黑色 可达 并且所有子节点都已经完成了遍历 （黑色节点的子节点不会被检查）

 增量更新
 删除某条关系的时候，将颜色变成灰色，这样就能重新从该节点开始标记

 历史快照
 删除某关系的时候 不真正的删除，等到下次回收的时候删除
